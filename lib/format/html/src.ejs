<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Covershot: Source: <%= filename %></title>
		<link rel="stylesheet" href="<%= pathToCSS %>/normalize.css">
		<link rel="stylesheet" href="<%= pathToCSS %>/covershot.css">

		<script type="text/javascript" src="<%= pathToScripts %>/jquery-1.7.1.min.js"></script>

		<script type="text/javascript" src="<%= pathToScripts %>/shCore.js"></script>
		<script type="text/javascript" src="<%= pathToScripts %>/shBrushJScript.js"></script>
		<link href="<%= pathToCSS %>/shCore.css" rel="stylesheet" type="text/css" />
		<link href="<%= pathToCSS %>/shThemeDefault.css" rel="stylesheet" type="text/css" />
	    <script>
	      window.onscroll = function () {
	        document.querySelectorAll('#topContainer')[0].className = (window.scrollY !== 0) ? 'shadowed' : '';
	      };
	    </script>
	</head>
	<body>
	    <div id="topContainer">
	      <div id="topBar">
	        <div id="topBarContent">
	          <p class="left"><a href="<%= pathToRoot %>/index.html">Covershot</a></p> 
	          <!-- <p class="right"><a href="">Coverage</a> <a href="hotspots.html">Hotspots</a></p> -->
	        </div>
	      </div>
	      <div id="bottomBar">
	        <div class="holder">
	          <ul class="summary">
	            <li>
	              <span class="coverageData"><%= hits %></span>
	              <p>hits</p>
	            </li>
	            <li>
	              <span class="coverageData"><%= misses %></span>
	              <p>misses</p>
	            </li>
	            <li>
	              <span class="coverageData"><%= sloc %></span>
	              <p>SLoC</p>
	            </li>
	            <li>
	              <span class="coverageData"><%= coverage.toFixed(1) %>%</span>
	              <p>coverage </p>
	            </li>
	            <li>
	              <%- renderPieChart(coverage / 100.0) %>
	            </li>
	          </ul>
	        </div>
	      </div>
	    </div>
		<div id="bodyWrapper">
			<section id="bod">
				<section id="mainContent">
					<script type="syntaxhighlighter" class="brush: js; class-name: 'rounded'"><![CDATA[<% for (var i in source) { %>
<%- (source[i].line || source[i].source) %><% } %> ]]></script>
				</section>
			</section>
		</div>
		<footer> 
			<p>Report generated by <a>Covershot</a> on <%= generated %>.</p> 
		</footer>
		<script type="text/javascript">
      function getUrlVars() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&#]+)=([^&#]*)/gi, function (m, key, value) {
          vars[key] = value;
        });
        return vars;
      }

      $(document).ready(function () {
        SyntaxHighlighter.all({'cb': function () {
          <% for (var i in source) { %>
            $('td.covgutter').append('<div class="line number<%= i %> index<%= i - 1 %> alt2">&nbsp;<%= source[i].coverage %>&nbsp;</div>');
          <% } %>

          var highlightStartLineNumber = getUrlVars()['highlightStartLineNumber'];
          var highlightEndLineNumber = getUrlVars()['highlightEndLineNumber'];
          if (highlightStartLineNumber && highlightEndLineNumber) {
            var bgColor = 'rgba(255, 255, 100, 0.62)';
            for (var line = highlightStartLineNumber; line <= highlightEndLineNumber; line++) {
              $('td.gutter div.number' + line).css('cssText', 'background-color: ' + bgColor + ' !important');
              $('td.covgutter div.number' + line).css('cssText', 'background-color: ' + bgColor + ' !important');
              $('td.code div.container div.number' + line).css('cssText', 'background-color: ' + bgColor + ' !important');
            }
          }

          var green = $.parseJSON('<%- JSON.stringify(green) %>');
          $.each(green, function (index, value) {
            $('td.gutter div.number' + value).html("<a id='line" + value + "' name='line" + value + "'></a>" + value);
            var bgColor = 'rgba(121, 252, 121, 0.62)';
            if (value >= highlightStartLineNumber && value <= highlightEndLineNumber) {
              bgColor = 'rgba(255, 255, 100, 0.62)';
            }
            $('td.gutter div.number' + value).css('cssText', 'background-color: ' + bgColor + ' !important');
            $('td.covgutter div.number' + value).css('cssText', 'background-color: ' + bgColor + ' !important');
            $('td.code div.container div.number' + value).css('cssText', 'background-color: ' + bgColor + ' !important');
          });

          var red = $.parseJSON('<%- JSON.stringify(red) %>');
          $.each(red, function (index, value) {
            $('td.gutter div.number' + value).html("<a id='line" + value + "' name='line" + value + "'></a>" + value);
            var bgColor = 'rgba(255, 0, 0, 0.32)';
            if (value >= highlightStartLineNumber && value <= highlightEndLineNumber) {
              bgColor = 'rgba(255, 255, 100, 0.62)';
            }
            $('td.gutter div.number' + value).css('cssText', 'background-color: ' + bgColor + ' !important');
            $('td.covgutter div.number' + value).css('cssText', 'background-color: ' + bgColor + ' !important; font-weight: bold !important');
            $('td.code div.container div.number' + value).css('cssText', 'background-color: ' + bgColor + ' !important');
          });
        }});
      });
		</script>
	</body>
</html>
